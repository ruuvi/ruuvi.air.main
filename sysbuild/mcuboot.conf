#
# @copyright Ruuvi Innovations Ltd
#
# SPDX-License-Identifier: BSD-3-Clause
#
CONFIG_KERNEL_BIN_NAME="ruuvi_air_mcuboot"

CONFIG_BOOT_FIRMWARE_LOADER=y
CONFIG_BOOT_FIRMWARE_LOADER_ENTRANCE_GPIO=y
CONFIG_BOOT_FIRMWARE_LOADER_PIN_RESET=n
CONFIG_BOOT_FIRMWARE_LOADER_BOOT_MODE=y
CONFIG_BOOT_FIRMWARE_LOADER_NO_APPLICATION=y
CONFIG_DISABLE_FLASH_PATCH=y
CONFIG_BOOT_VALIDATE_SLOT0=y

CONFIG_MCUBOOT_ACTION_HOOKS=y
CONFIG_MCUBOOT_INDICATION_LED=y

CONFIG_FILE_SYSTEM_MKFS=y

# These configurations should be used when using nrf/samples/bootloader
# as the immutable bootloader (B0), and MCUBoot as the second stage updateable
# bootloader.

# Set ECDSA as signing mechanism
CONFIG_BOOT_SIGNATURE_TYPE_ECDSA_P256=y

CONFIG_SECURE_BOOT_CRYPTO=y
CONFIG_SECURE_BOOT_STORAGE=y
CONFIG_SECURE_BOOT_VALIDATION=y
CONFIG_SB_CRYPTO_OBERON_ECDSA_SECP256R1=y
CONFIG_SB_CRYPTO_OBERON_SHA256=y
# Use crypto backend from B0
# CONFIG_SB_CRYPTO_CLIENT_ECDSA_SECP256R1=y
# CONFIG_SB_CRYPTO_CLIENT_SHA256=y
# CONFIG_BOOT_NRF_EXTERNAL_CRYPTO=y
# CONFIG_BL_SHA256_EXT_API_REQUIRED=y
# CONFIG_BL_SECP256R1_EXT_API_REQUIRED=y
# CONFIG_BL_VALIDATE_FW_EXT_API_REQUIRED=y


CONFIG_BOOT_MAX_IMG_SECTORS=4

CONFIG_LOG=y

CONFIG_DEBUG=y
CONFIG_DEBUG_INFO=y
CONFIG_DEBUG_THREAD_INFO=y
CONFIG_DEBUG_OPTIMIZATIONS=y
# CONFIG_NO_OPTIMIZATIONS=y
CONFIG_EXTRA_EXCEPTION_INFO=y

CONFIG_UPDATEABLE_IMAGE_NUMBER=1


#CONFIG_BOOT_SWAP_USING_MOVE=y
#CONFIG_BOOT_UPGRADE_ONLY=y
#CONFIG_BOOT_FIRMWARE_LOADER=y
#CONFIG_BOOT_SWAP_SAVE_ENCTLV

CONFIG_MCUBOOT_DOWNGRADE_PREVENTION=y

#CONFIG_BOOT_SHARE_DATA=y
#CONFIG_BOOT_MGMT_CUSTOM_IMG_LIST=y
#CONFIG_BOOT_IMAGE_ACCESS_HOOKS=y

#CONFIG_MCUBOOT_SERIAL_DIRECT_IMAGE_UPLOAD=y
#CONFIG_BOOT_SERIAL_WAIT_FOR_DFU=y
#CONFIG_BOOT_USB_DFU_WAIT=y
#CONFIG_BOOT_USB_DFU_GPIO=y
#CONFIG_BOOT_MAX_IMG_SECTORS

#CONFIG_MCUBOOT_MCUBOOT_IMAGE_NUMBER=2
#PM_S1_ADDRESS


# ===========================================
CONFIG_PM=n

CONFIG_MAIN_STACK_SIZE=10240

CONFIG_BOOT_SWAP_SAVE_ENCTLV=n
CONFIG_BOOT_ENCRYPT_IMAGE=n

CONFIG_BOOT_UPGRADE_ONLY=n
CONFIG_BOOT_BOOTSTRAP=n

### mbedTLS has its own heap
# CONFIG_HEAP_MEM_POOL_SIZE is not set

### We never want Zephyr's copy of tinycrypt.  If tinycrypt is needed,
### MCUboot has its own copy in tree.
# CONFIG_TINYCRYPT is not set
# CONFIG_TINYCRYPT_ECC_DSA is not set
# CONFIG_TINYCRYPT_SHA256 is not set

CONFIG_FLASH=y
CONFIG_FPROTECT=y

CONFIG_REBOOT=y
CONFIG_POWEROFF=y

### Various Zephyr boards enable features that we don't want.
# CONFIG_BT is not set
# CONFIG_BT_CTLR is not set
# CONFIG_I2C is not set

# --- Basic Logging Setup ---
CONFIG_LOG=y
CONFIG_LOG_MODE_MINIMAL=y # former CONFIG_MODE_MINIMAL
### Ensure Zephyr logging changes don't use more resources
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MAX_LEVEL=3
### Use info log level by default
CONFIG_MCUBOOT_LOG_LEVEL_INF=y
### Decrease footprint by ~4 KB in comparison to CBPRINTF_COMPLETE=y
CONFIG_CBPRINTF_NANO=y
### Use the minimal C library to reduce flash usage
CONFIG_MINIMAL_LIBC=y
CONFIG_PRINTK=y
CONFIG_CONSOLE=y

# --- Enable UART ---
CONFIG_SERIAL=y           # Ensure Serial driver support is enabled (usually default)
CONFIG_UART_CONSOLE=y     # Enable UART as a potential console (usually default)
CONFIG_LOG_BACKEND_UART=y # Enable UART as a logging backend

# --- Enable RTT ---
# When `CONFIG_LOG_MODE_MINIMAL=y`,
# then the logging system falls back to a simpler mechanism.
# When CONFIG_LOG_PRINTK=y is also enabled, calls to LOG_x() functions essentially become wrappers
# that directly call printk().
# The printk() function, by default, sends its output to the single active console.
# Even if you enable both CONFIG_UART_CONSOLE=y and CONFIG_RTT_CONSOLE=y,
# Zephyr usually selects only one as the active console (which is UART by default).
# So, to enable RTT you need to disable the UART console: `CONFIG_SERIAL=n`.
# But here a custom wrapper for 'vprintk' is used to send the log messages to both targets UART and RTT.
CONFIG_USE_SEGGER_RTT=y
CONFIG_RTT_CONSOLE=y      # Enable RTT as a potential console
CONFIG_LOG_BACKEND_RTT=y  # Enable RTT as a logging backend

# Configure Segger RTT UpBuffer, with 184 additional bytes for other RTT data, in total it's 4096
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=3912
CONFIG_SEGGER_RTT_SECTION_CUSTOM=y
CONFIG_SEGGER_RTT_SECTION_CUSTOM_NAME="rtt_data"

CONFIG_NRF_RTC_TIMER_USER_CHAN_COUNT=0

# CONFIG_FLASH_MAP=y
CONFIG_NORDIC_QSPI_NOR=y
CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_LITTLEFS=y
CONFIG_MULTITHREADING=y


CONFIG_RETAINED_MEM=y
CONFIG_RETENTION=y
CONFIG_RETENTION_BOOT_MODE=y
CONFIG_RETENTION_BOOTLOADER_INFO=y
CONFIG_RETENTION_BOOTLOADER_INFO_TYPE_MCUBOOT=y
CONFIG_RETENTION_BOOTLOADER_INFO_OUTPUT_SETTINGS=y
CONFIG_BOOT_SHARE_DATA=y
CONFIG_BOOT_SHARE_DATA_BOOTINFO=y
CONFIG_BOOT_SHARE_BACKEND_RETENTION=y

CONFIG_MEASURED_BOOT=n

CONFIG_GPIO_INIT_PRIORITY=40
CONFIG_NORDIC_QSPI_NOR_INIT_PRIORITY=45

# NCS boot banner
CONFIG_NCS_APPLICATION_BOOT_BANNER_STRING="Ruuvi MCUboot"

CONFIG_FW_INFO=y
