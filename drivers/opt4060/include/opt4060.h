/**
 * @copyright Ruuvi Innovations Ltd, license BSD-3-Clause.
 */

#ifndef ZEPHYR_DRIVERS_SENSOR_OPT4060_H_
#define ZEPHYR_DRIVERS_SENSOR_OPT4060_H_

#include <stdint.h>
#include <zephyr/kernel.h>

#define OPT4060_MEASUREMENT_CNT_MASK (0xFU)

typedef uint8_t opt4060_measurement_cnt_t;

#define OPT4060_REG_CONFIG_SHIFT_CONV_TIME       (6U)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_600_US  (0U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_1_MS    (1U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_1_8_MS  (2U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_3_4_MS  (3U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_6_5_MS  (4U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_12_7_MS (5U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_25_MS   (6U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_50_MS   (7U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_100_MS  (8U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_200_MS  (9U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_400_MS  (10U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_800_MS  (11U << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)
#define OPT4060_REG_CONFIG_VAL_CONV_TIME_MASK    (0xFU << OPT4060_REG_CONFIG_SHIFT_CONV_TIME)

#if defined(CONFIG_OPT4060_CONV_TIME_600_US) && CONFIG_OPT4060_CONV_TIME_600_US
#define OPT4060_CONV_TIME_US 600
#elif defined(CONFIG_OPT4060_CONV_TIME_1_MS) && CONFIG_OPT4060_CONV_TIME_1_MS
#define OPT4060_CONV_TIME_US 1000
#elif defined(CONFIG_OPT4060_CONV_TIME_1_8_MS) && CONFIG_OPT4060_CONV_TIME_1_8_MS
#define OPT4060_CONV_TIME_US 1800
#elif defined(CONFIG_OPT4060_CONV_TIME_3_4_MS) && CONFIG_OPT4060_CONV_TIME_3_4_MS
#define OPT4060_CONV_TIME_US 3400
#elif defined(CONFIG_OPT4060_CONV_TIME_6_5_MS) && CONFIG_OPT4060_CONV_TIME_6_5_MS
#define OPT4060_CONV_TIME_US 6500
#elif defined(CONFIG_OPT4060_CONV_TIME_12_7_MS) && CONFIG_OPT4060_CONV_TIME_12_7_MS
#define OPT4060_CONV_TIME_US 12700
#elif defined(CONFIG_OPT4060_CONV_TIME_25_MS) && CONFIG_OPT4060_CONV_TIME_25_MS
#define OPT4060_CONV_TIME_US 25000
#elif defined(CONFIG_OPT4060_CONV_TIME_50_MS) && CONFIG_OPT4060_CONV_TIME_50_MS
#define OPT4060_CONV_TIME_US 50000
#elif defined(CONFIG_OPT4060_CONV_TIME_100_MS) && CONFIG_OPT4060_CONV_TIME_100_MS
#define OPT4060_CONV_TIME_US 100000
#elif defined(CONFIG_OPT4060_CONV_TIME_200_MS) && CONFIG_OPT4060_CONV_TIME_200_MS
#define OPT4060_CONV_TIME_US 200000
#elif defined(CONFIG_OPT4060_CONV_TIME_400_MS) && CONFIG_OPT4060_CONV_TIME_400_MS
#define OPT4060_CONV_TIME_US 400000
#elif defined(CONFIG_OPT4060_CONV_TIME_800_MS) && CONFIG_OPT4060_CONV_TIME_800_MS
#define OPT4060_CONV_TIME_US 800000
#else
#error "Unsupported conversion time"
#endif

enum opt4060_channel_e {
	OPT4060_CHANNEL_RED = 0,
	OPT4060_CHANNEL_GREEN = 1,
	OPT4060_CHANNEL_BLUE = 2,
	OPT4060_CHANNEL_LUMINOSITY = 3,
	OPT4060_CHANNEL_NUM = 4,
};

typedef int opt4060_ret_t;

int32_t opt4060_get_one_measurement_duration_ticks(const struct device *const p_dev);

opt4060_ret_t opt4060_configure_conv_time(const struct device *const p_dev,
					  const uint16_t conv_time);

#endif /* ZEPHYR_DRIVERS_SENSOR_OPT4060_H_ */
